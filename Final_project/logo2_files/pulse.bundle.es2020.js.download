!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}function i(t,e,i,n){return new(i||(i=Promise))((function(r,s){function o(t){try{c(n.next(t))}catch(t){s(t)}}function a(t){try{c(n.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((n=n.apply(t,e||[])).next())}))}function n(t,e){var i,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{i=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function r(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||e-->0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}function o(t,e){for(var i=0,n=e.length,r=t.length;i<n;i++,r++)t[r]=e[i];return t}function a(t){return this instanceof a?(this.v=t,this):new a(t)}function c(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,r=i.apply(t,e||[]),s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(t){r[t]&&(n[t]=function(e){return new Promise((function(i,n){s.push([t,e,i,n])>1||c(t,e)}))})}function c(t,e){try{(i=r[t](e)).value instanceof a?Promise.resolve(i.value.v).then(u,h):l(s[0][2],i)}catch(t){l(s[0][3],t)}var i}function u(t){c("next",t)}function h(t){c("throw",t)}function l(t,e){t(e),s.shift(),s.length&&c(s[0][0],s[0][1])}}function u(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,i=t[Symbol.asyncIterator];return i?i.call(t):(t=r(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(i){e[i]=t[i]&&function(e){return new Promise((function(n,r){(function(t,e,i,n){Promise.resolve(n).then((function(e){t({value:e,done:i})}),e)})(n,r,(e=t[i](e)).done,e.value)}))}}}function h(t){return"function"==typeof t}function l(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var d=l((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function f(t,e){if(t){var i=t.indexOf(e);0<=i&&t.splice(i,1)}}var p=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}var e;return t.prototype.unsubscribe=function(){var t,e,i,n,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var u=r(c),l=u.next();!l.done;l=u.next()){l.value.remove(this)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}else c.remove(this);var f=this.initialTeardown;if(h(f))try{f()}catch(t){a=t instanceof d?t.errors:[t]}var p=this._teardowns;if(p){this._teardowns=null;try{for(var v=r(p),g=v.next();!g.done;g=v.next()){var y=g.value;try{m(y)}catch(t){a=null!=a?a:[],t instanceof d?a=o(o([],s(a)),s(t.errors)):a.push(t)}}}catch(t){i={error:t}}finally{try{g&&!g.done&&(n=v.return)&&n.call(v)}finally{if(i)throw i.error}}}if(a)throw new d(a)}},t.prototype.add=function(e){var i;if(e&&e!==this)if(this.closed)m(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(i=this._teardowns)&&void 0!==i?i:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&f(e,t)},t.prototype.remove=function(e){var i=this._teardowns;i&&f(i,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),v=p.EMPTY;function g(t){return t instanceof p||t&&"closed"in t&&h(t.remove)&&h(t.add)&&h(t.unsubscribe)}function m(t){h(t)?t():t.unsubscribe()}var y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},b={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=b.delegate;return((null==i?void 0:i.setTimeout)||setTimeout).apply(void 0,o([],s(t)))},clearTimeout:function(t){var e=b.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function w(t){b.setTimeout((function(){var e=y.onUnhandledError;if(!e)throw t;e(t)}))}function S(){}var _=k("C",void 0,void 0);function k(t,e,i){return{kind:t,value:e,error:i}}var E=null;function I(t){if(y.useDeprecatedSynchronousErrorHandling){var e=!E;if(e&&(E={errorThrown:!1,error:null}),t(),e){var i=E,n=i.errorThrown,r=i.error;if(E=null,n)throw r}}else t()}function T(t){y.useDeprecatedSynchronousErrorHandling&&E&&(E.errorThrown=!0,E.error=t)}var x=function(t){function i(e){var i=t.call(this)||this;return i.isStopped=!1,e?(i.destination=e,g(e)&&e.add(i)):i.destination=O,i}return e(i,t),i.create=function(t,e,i){return new C(t,e,i)},i.prototype.next=function(t){this.isStopped?N(function(t){return k("N",t,void 0)}(t),this):this._next(t)},i.prototype.error=function(t){this.isStopped?N(k("E",void 0,t),this):(this.isStopped=!0,this._error(t))},i.prototype.complete=function(){this.isStopped?N(_,this):(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},i.prototype._next=function(t){this.destination.next(t)},i.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},i.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},i}(p),C=function(t){function i(e,i,n){var r,s=t.call(this)||this;if(h(e))r=e;else if(e){var o;r=e.next,i=e.error,n=e.complete,s&&y.useDeprecatedNextContext?(o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()}:o=e,r=null==r?void 0:r.bind(o),i=null==i?void 0:i.bind(o),n=null==n?void 0:n.bind(o)}return s.destination={next:r?A(r):S,error:A(null!=i?i:P),complete:n?A(n):S},s}return e(i,t),i}(x);function A(t,e){return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];try{t.apply(void 0,o([],s(e)))}catch(t){y.useDeprecatedSynchronousErrorHandling?T(t):w(t)}}}function P(t){throw t}function N(t,e){var i=y.onStoppedNotification;i&&b.setTimeout((function(){return i(t,e)}))}var O={closed:!0,next:S,error:P,complete:S},M="function"==typeof Symbol&&Symbol.observable||"@@observable";function L(t){return t}function R(t){return 0===t.length?L:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var D=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var i=new t;return i.source=this,i.operator=e,i},t.prototype.subscribe=function(t,e,i){var n,r=this,s=(n=t)&&n instanceof x||function(t){return t&&h(t.next)&&h(t.error)&&h(t.complete)}(n)&&g(n)?t:new C(t,e,i);return I((function(){var t=r,e=t.operator,i=t.source;s.add(e?e.call(s,i):i?r._subscribe(s):r._trySubscribe(s))})),s},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var i=this;return new(e=K(e))((function(e,n){var r;r=i.subscribe((function(e){try{t(e)}catch(t){n(t),null==r||r.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[M]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return R(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=K(t))((function(t,i){var n;e.subscribe((function(t){return n=t}),(function(t){return i(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function K(t){var e;return null!==(e=null!=t?t:y.Promise)&&void 0!==e?e:Promise}function U(t){return function(e){if(function(t){return h(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var j=function(t){function i(e,i,n,r,s){var o=t.call(this,e)||this;return o.onFinalize=s,o._next=i?function(t){try{i(t)}catch(t){e.error(t)}}:t.prototype._next,o._error=r?function(t){try{r(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,o._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,o}return e(i,t),i.prototype.unsubscribe=function(){var e,i=this.closed;t.prototype.unsubscribe.call(this),!i&&(null===(e=this.onFinalize)||void 0===e||e.call(this))},i}(x),B=l((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),H=function(t){function i(){var e=t.call(this)||this;return e.closed=!1,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return e(i,t),i.prototype.lift=function(t){var e=new V(this,this);return e.operator=t,e},i.prototype._throwIfClosed=function(){if(this.closed)throw new B},i.prototype.next=function(t){var e=this;I((function(){var i,n;if(e._throwIfClosed(),!e.isStopped){var s=e.observers.slice();try{for(var o=r(s),a=o.next();!a.done;a=o.next()){a.value.next(t)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}}}))},i.prototype.error=function(t){var e=this;I((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var i=e.observers;i.length;)i.shift().error(t)}}))},i.prototype.complete=function(){var t=this;I((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},i.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(i.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),i.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},i.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},i.prototype._innerSubscribe=function(t){var e=this,i=e.hasError,n=e.isStopped,r=e.observers;return i||n?v:(r.push(t),new p((function(){return f(r,t)})))},i.prototype._checkFinalizedStatuses=function(t){var e=this,i=e.hasError,n=e.thrownError,r=e.isStopped;i?t.error(n):r&&t.complete()},i.prototype.asObservable=function(){var t=new D;return t.source=this,t},i.create=function(t,e){return new V(t,e)},i}(D),V=function(t){function i(e,i){var n=t.call(this)||this;return n.destination=e,n.source=i,n}return e(i,t),i.prototype.next=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===i||i.call(e,t)},i.prototype.error=function(t){var e,i;null===(i=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===i||i.call(e,t)},i.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},i.prototype._subscribe=function(t){var e,i;return null!==(i=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==i?i:v},i}(H),$=function(t){function i(e){var i=t.call(this)||this;return i._value=e,i}return e(i,t),Object.defineProperty(i.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),i.prototype._subscribe=function(e){var i=t.prototype._subscribe.call(this,e);return!i.closed&&e.next(this._value),i},i.prototype.getValue=function(){var t=this,e=t.hasError,i=t.thrownError,n=t._value;if(e)throw i;return this._throwIfClosed(),n},i.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},i}(H),F={now:function(){return(F.delegate||Date).now()},delegate:void 0},Y=function(t){function i(e,i,n){void 0===e&&(e=1/0),void 0===i&&(i=1/0),void 0===n&&(n=F);var r=t.call(this)||this;return r._bufferSize=e,r._windowTime=i,r._timestampProvider=n,r._buffer=[],r._infiniteTimeWindow=!0,r._infiniteTimeWindow=i===1/0,r._bufferSize=Math.max(1,e),r._windowTime=Math.max(1,i),r}return e(i,t),i.prototype.next=function(e){var i=this,n=i.isStopped,r=i._buffer,s=i._infiniteTimeWindow,o=i._timestampProvider,a=i._windowTime;n||(r.push(e),!s&&r.push(o.now()+a)),this._trimBuffer(),t.prototype.next.call(this,e)},i.prototype._subscribe=function(t){this._throwIfClosed(),this._trimBuffer();for(var e=this._innerSubscribe(t),i=this._infiniteTimeWindow,n=this._buffer.slice(),r=0;r<n.length&&!t.closed;r+=i?1:2)t.next(n[r]);return this._checkFinalizedStatuses(t),e},i.prototype._trimBuffer=function(){var t=this,e=t._bufferSize,i=t._timestampProvider,n=t._buffer,r=t._infiniteTimeWindow,s=(r?1:2)*e;if(e<1/0&&s<n.length&&n.splice(0,n.length-s),!r){for(var o=i.now(),a=0,c=1;c<n.length&&n[c]<=o;c+=2)a=c;a&&n.splice(0,a+1)}},i}(H),z=function(t){function i(e,i){return t.call(this)||this}return e(i,t),i.prototype.schedule=function(t,e){return this},i}(p),q={setInterval:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=q.delegate;return((null==i?void 0:i.setInterval)||setInterval).apply(void 0,o([],s(t)))},clearInterval:function(t){var e=q.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},G=function(t){function i(e,i){var n=t.call(this,e,i)||this;return n.scheduler=e,n.work=i,n.pending=!1,n}return e(i,t),i.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,n=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(n,i,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},i.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),q.setInterval(t.flush.bind(t,this),i)},i.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),null!=i&&this.delay===i&&!1===this.pending)return e;q.clearInterval(e)},i.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},i.prototype._execute=function(t,e){var i,n=!1;try{this.work(t)}catch(t){n=!0,i=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),i},i.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,i=this.scheduler,n=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,f(n,this),null!=e&&(this.id=this.recycleAsyncId(i,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},i}(z),J=function(){function t(e,i){void 0===i&&(i=t.now),this.schedulerActionCtor=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(i,e)},t.now=F.now,t}(),W=new(function(t){function i(e,i){void 0===i&&(i=J.now);var n=t.call(this,e,i)||this;return n.actions=[],n._active=!1,n._scheduled=void 0,n}return e(i,t),i.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var i;this._active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},i}(J))(G),X=new D((function(t){return t.complete()}));function Q(t,e){return new D((function(i){var n=0;return e.schedule((function(){n===t.length?i.complete():(i.next(t[n++]),i.closed||this.schedule())}))}))}var Z=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function tt(t){return h(null==t?void 0:t.then)}var et="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function it(t,e){if(!t)throw new Error("Iterable cannot be null");return new D((function(i){var n=new p;return n.add(e.schedule((function(){var r=t[Symbol.asyncIterator]();n.add(e.schedule((function(){var t=this;r.next().then((function(e){e.done?i.complete():(i.next(e.value),t.schedule())}))})))}))),n}))}function nt(t){return h(t[M])}function rt(t){return h(null==t?void 0:t[et])}function st(t){return Symbol.asyncIterator&&h(null==t?void 0:t[Symbol.asyncIterator])}function ot(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function at(t){return c(this,arguments,(function(){var e,i,r;return n(this,(function(n){switch(n.label){case 0:e=t.getReader(),n.label=1;case 1:n.trys.push([1,,9,10]),n.label=2;case 2:return[4,a(e.read())];case 3:return i=n.sent(),r=i.value,i.done?[4,a(void 0)]:[3,5];case 4:return[2,n.sent()];case 5:return[4,a(r)];case 6:return[4,n.sent()];case 7:return n.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function ct(t){return h(null==t?void 0:t.getReader)}function ut(t,e){if(null!=t){if(nt(t))return function(t,e){return new D((function(i){var n=new p;return n.add(e.schedule((function(){var r=t[M]();n.add(r.subscribe({next:function(t){n.add(e.schedule((function(){return i.next(t)})))},error:function(t){n.add(e.schedule((function(){return i.error(t)})))},complete:function(){n.add(e.schedule((function(){return i.complete()})))}}))}))),n}))}(t,e);if(Z(t))return Q(t,e);if(tt(t))return function(t,e){return new D((function(i){return e.schedule((function(){return t.then((function(t){i.add(e.schedule((function(){i.next(t),i.add(e.schedule((function(){return i.complete()})))})))}),(function(t){i.add(e.schedule((function(){return i.error(t)})))}))}))}))}(t,e);if(st(t))return it(t,e);if(rt(t))return function(t,e){return new D((function(i){var n;return i.add(e.schedule((function(){n=t[et](),function(t,e,i,n){void 0===n&&(n=0);var r=e.schedule((function(){try{i.call(this)}catch(e){t.error(e)}}),n);t.add(r)}(i,e,(function(){var t=n.next(),e=t.value;t.done?i.complete():(i.next(e),this.schedule())}))}))),function(){return h(null==n?void 0:n.return)&&n.return()}}))}(t,e);if(ct(t))return function(t,e){return it(at(t),e)}(t,e)}throw ot(t)}function ht(t,e){return e?ut(t,e):lt(t)}function lt(t){if(t instanceof D)return t;if(null!=t){if(nt(t))return n=t,new D((function(t){var e=n[M]();if(h(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Z(t))return dt(t);if(tt(t))return i=t,new D((function(t){i.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,w)}));if(st(t))return ft(t);if(rt(t))return e=t,new D((function(t){var i,n;try{for(var s=r(e),o=s.next();!o.done;o=s.next()){var a=o.value;if(t.next(a),t.closed)return}}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}t.complete()}));if(ct(t))return ft(at(t))}var e,i,n;throw ot(t)}function dt(t){return new D((function(e){for(var i=0;i<t.length&&!e.closed;i++)e.next(t[i]);e.complete()}))}function ft(t){return new D((function(e){(function(t,e){var r,s,o,a;return i(this,void 0,void 0,(function(){var i,c;return n(this,(function(n){switch(n.label){case 0:n.trys.push([0,5,6,11]),r=u(t),n.label=1;case 1:return[4,r.next()];case 2:if((s=n.sent()).done)return[3,4];if(i=s.value,e.next(i),e.closed)return[2];n.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return c=n.sent(),o={error:c},[3,11];case 6:return n.trys.push([6,,9,10]),s&&!s.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:n.sent(),n.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function pt(t,e){return e?Q(t,e):dt(t)}function vt(t){return t[t.length-1]}function gt(t){return h(vt(t))?t.pop():void 0}function mt(t){return(e=vt(t))&&h(e.schedule)?t.pop():void 0;var e}function yt(t,e){return"number"==typeof vt(t)?t.pop():e}var bt=l((function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}}));function wt(t,e){return U((function(i,n){var r=0;i.subscribe(new j(n,(function(i){n.next(t.call(e,i,r++))})))}))}var St=Array.isArray;function _t(t){return wt((function(e){return function(t,e){return St(e)?t.apply(void 0,o([],s(e))):t(e)}(t,e)}))}var kt=Array.isArray,Et=Object.getPrototypeOf,It=Object.prototype,Tt=Object.keys;function xt(t){if(1===t.length){var e=t[0];if(kt(e))return{args:e,keys:null};if((n=e)&&"object"==typeof n&&Et(n)===It){var i=Tt(e);return{args:i.map((function(t){return e[t]})),keys:i}}}var n;return{args:t,keys:null}}function Ct(t,e){return t.reduce((function(t,i,n){return t[i]=e[n],t}),{})}function At(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=mt(t),n=gt(t),r=xt(t),s=r.args,o=r.keys;if(0===s.length)return ht([],i);var a=new D(Pt(s,i,o?function(t){return Ct(o,t)}:L));return n?a.pipe(_t(n)):a}function Pt(t,e,i){return void 0===i&&(i=L),function(n){Nt(e,(function(){for(var r=t.length,s=new Array(r),o=r,a=r,c=function(r){Nt(e,(function(){var c=ht(t[r],e),u=!1;c.subscribe(new j(n,(function(t){s[r]=t,u||(u=!0,a--),a||n.next(i(s.slice()))}),(function(){--o||n.complete()})))}),n)},u=0;u<r;u++)c(u)}),n)}}function Nt(t,e,i){t?i.add(t.schedule(e)):e()}function Ot(t,e,i){return void 0===i&&(i=1/0),h(e)?Ot((function(i,n){return wt((function(t,r){return e(i,t,n,r)}))(lt(t(i,n)))}),i):("number"==typeof e&&(i=e),U((function(e,n){return function(t,e,i,n,r,s,o,a){var c=[],u=0,h=0,l=!1,d=function(){!l||c.length||u||e.complete()},f=function(t){return u<n?p(t):c.push(t)},p=function(t){s&&e.next(t),u++;var a=!1;lt(i(t,h++)).subscribe(new j(e,(function(t){null==r||r(t),s?f(t):e.next(t)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var t=function(){var t=c.shift();o?e.add(o.schedule((function(){return p(t)}))):p(t)};c.length&&u<n;)t();d()}catch(t){e.error(t)}})))};return t.subscribe(new j(e,f,(function(){l=!0,d()}))),function(){null==a||a()}}(e,n,t,i)})))}function Mt(t){return void 0===t&&(t=1/0),Ot(L,t)}var Lt,Rt=["addListener","removeListener"],Dt=["addEventListener","removeEventListener"],Kt=["on","off"];function Ut(t,e,i,n){if(h(i)&&(n=i,i=void 0),n)return Ut(t,e,i).pipe(_t(n));var r=s(function(t){return h(t.addEventListener)&&h(t.removeEventListener)}(t)?Dt.map((function(n){return function(r){return t[n](e,r,i)}})):function(t){return h(t.addListener)&&h(t.removeListener)}(t)?Rt.map(jt(t,e)):function(t){return h(t.on)&&h(t.off)}(t)?Kt.map(jt(t,e)):[],2),o=r[0],a=r[1];if(!o&&Z(t))return Ot((function(t){return Ut(t,e,i)}))(pt(t));if(!o)throw new TypeError("Invalid event target");return new D((function(t){var e=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return t.next(1<e.length?e:e[0])};return o(e),function(){return a(e)}}))}function jt(t,e){return function(i){return function(n){return t[i](e,n)}}}function Bt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=mt(t),n=yt(t,1/0),r=t;return r.length?1===r.length?lt(r[0]):Mt(n)(pt(r,i)):X}function Ht(t,e){return U((function(i,n){var r=0;i.subscribe(new j(n,(function(i){return t.call(e,i,r++)&&n.next(i)})))}))}function Vt(t){return U((function(e,i){var n=!1;e.subscribe(new j(i,(function(t){n=!0,i.next(t)}),(function(){n||i.next(t),i.complete()})))}))}function $t(t){return t<=0?function(){return X}:U((function(e,i){var n=0;e.subscribe(new j(i,(function(e){++n<=t&&(i.next(e),t<=n&&i.complete())})))}))}function Ft(t,e){return void 0===e&&(e=L),t=null!=t?t:Yt,U((function(i,n){var r,s=!0;i.subscribe(new j(n,(function(i){var o=e(i);!s&&t(r,o)||(s=!1,r=o,n.next(i))})))}))}function Yt(t,e){return t===e}function zt(t){return void 0===t&&(t=qt),U((function(e,i){var n=!1;e.subscribe(new j(i,(function(t){n=!0,i.next(t)}),(function(){return n?i.complete():i.error(t())})))}))}function qt(){return new bt}class Gt{constructor(t,e,i){this.persistentStorage=e,this.env=i,this.messages=new H,this.channelName=`pulse_bc_${t}`,this.init()}postMessage(t){this.nativeChannel?this.nativeChannel.postMessage(t):this.persistentStorage.setJSON(this.channelName,t)}init(){if(this.env.win.BroadcastChannel)return this.nativeChannel=new this.env.win.BroadcastChannel(this.channelName),void this.nativeChannel.addEventListener("message",(t=>{this.messages.next(t.data)}));this.persistentStorage.change(this.channelName,"full","external").subscribe((t=>{const e=JSON.parse(t.value||"null");this.messages.next(e)}))}}class Jt{constructor(t,e,i,n){this.oneTrust=t,this.logger=e,this.hashStore=i,this.config=n;const r=this.buildConsentChecks(this.config.consentChecks||[]),s=r.map((t=>t.result.pipe(wt((e=>({consent:{consent:t.consent,mode:t.mode,report:t.report,type:t.type},result:e}))))));this.consentChanges=Bt(...s),this.trackerConsentStream=this.createTrackerCheckerStream(r)}trackingEnabled(){return this.trackerConsentStream}softChanges(){return this.consentChanges}changes(){return this.consentChanges.pipe(Ht((({consent:t,result:e})=>{const i="string"==typeof t.consent?t.consent:t.consent.name,n=`tracking_consent_${t.type}${i}`;return this.hashStore.changed(n,e)})))}createTrackerCheckerStream(t){const e=t.every((t=>"opt-out"===t.mode)),i=new $(e),n=t.map((t=>t.result.pipe(wt((e=>{if("tracking"===t.type){if("boolean"==typeof e.performance_cookies)return e.performance_cookies;if("pending"===e.state)return"opt-out"===t.mode}return!0})))));return n.length&&At(n).pipe(wt((t=>t.every((t=>!0===t))))).subscribe((t=>i.next(t))),i.asObservable().pipe(Ft())}buildConsentChecks(t){var e;const i=[];for(const n of t)if("tracking"===n.type)if("OneTrust"===n.consent){const t=this.oneTrust.changes();i.push({...n,result:t})}else if("object"==typeof n.consent&&"function"==typeof(null===(e=n.consent)||void 0===e?void 0:e.handler)){const t=this.buildFunctionConsentChecker(n);i.push(t)}else this.logger.warn("Consent","Unsupported ConsentChecker!");else this.logger.warn("Consent","Unsupported ConsentCheck type!");return i}buildFunctionConsentChecker(t){var e;const i=new Y;if("object"==typeof t.consent&&"function"==typeof(null===(e=t.consent)||void 0===e?void 0:e.handler)){const e=t.consent.handler(i.next.bind(i));"object"==typeof e&&((n=e)&&(n instanceof D||h(n.lift)&&h(n.subscribe)))?e.subscribe(i):this.isPromise(e)?ht(e).subscribe(i):this.isValidResult(e)&&i.next(e)}var n;return{...t,result:i.pipe(Ht((t=>this.isValidResult(t))))}}isPromise(t){return t instanceof Promise||"object"==typeof t&&"function"==typeof(null==t?void 0:t.then)}isValidResult(t){const e=t;return"object"==typeof e&&("pending"===(null==e?void 0:e.state)||"responded"===(null==e?void 0:e.state))}}class Wt{constructor(t){this.unPrefixedCookieStorage=t,this.cookieName="OptanonConsent",this.boxCookieName="OptanonAlertBoxClosed"}changes(){const t=this.parseOneTrustCookie(),e=new $(t),i=new H;var n,r;return i.pipe((n=30,void 0===r&&(r=W),U((function(t,e){var i=null,s=null,o=null,a=function(){if(i){i.unsubscribe(),i=null;var t=s;s=null,e.next(t)}};function c(){var t=o+n,s=r.now();if(s<t)return i=this.schedule(void 0,t-s),void e.add(i);a()}t.subscribe(new j(e,(function(t){s=t,o=r.now(),i||(i=r.schedule(c,n),e.add(i))}),(function(){a(),e.complete()}),void 0,(function(){s=i=null})))}))),wt((()=>this.parseOneTrustCookie()))).subscribe((t=>e.next(t))),this.unPrefixedCookieStorage.change(this.cookieName,"full","all").subscribe((()=>i.next())),this.unPrefixedCookieStorage.change(this.boxCookieName,"full","all").subscribe((()=>i.next())),e}parseOneTrustCookie(){const t=this.unPrefixedCookieStorage.get(this.cookieName)||"",e=new URLSearchParams(t||""),i=this.parseConsentGroups(e);if(!i)return{state:"pending"};const n=e.get("consentId")||void 0,r=this.getResponseTime(),s=!Number.isSafeInteger(r)||"true"===e.get("AwaitingReconsent"),o="boolean"==typeof i.C0001?i.C0001:void 0,a="boolean"==typeof i.C0002?i.C0002:void 0,c="boolean"==typeof i.C0003?i.C0003:void 0,u="boolean"==typeof i.C0004?i.C0004:void 0;return{state:s?"pending":"responded",response_time:r,provider_consent_id:n,necessary_cookies:o,functional_cookies:c,performance_cookies:a,social_media_cookies:"boolean"==typeof i.C0005?i.C0005:void 0,targeting_cookies:u}}parseConsentGroups(t){const e=(t.get("groups")||"").trim();if(e)return e.split(",").reduce(((t,e)=>{const i=(e||"").split(":").map((t=>t.trim())),n=i[0],r="1"===i[1]||"true"===i[1];return n&&2===i.length&&(t[n]=r),t}),{})}getResponseTime(){const t=this.unPrefixedCookieStorage.get(this.boxCookieName),e=t?new Date(t):void 0;return(null==e?void 0:e.getTime())||void 0}}class Xt{unsafeShortHash(t){let e=5381,i=t.length;for(;i;)e=33*e^t.charCodeAt(--i);return e>>>=0,e.toString(36)}}class Qt{constructor(t){this.env=t}now(){return this.env.win.Date.now()}hrtTime(){return this.env.win.performance.timeOrigin+this.env.win.performance.now()}hrt(){return this.env.win.performance.now()}timezoneOffset(){const t=new this.env.win.Date;return t.getTimezoneOffset&&t.getTimezoneOffset()}}class Zt{constructor(t,e){this.storage=t,this.KEY_DEBUG="debug",t.change(this.KEY_DEBUG).subscribe((t=>this.getDebugKeys(t.value)));const i=this.getDebugKeys();this.items=new $(i),Array.isArray(e.debug)&&this.enable(...e.debug)}enabled(t){const e=this.getDebugKeys();return e.has(t)||e.has("all")}enable(...t){const e=this.getDebugKeys();let i=!1;for(const n of t)i=i||!e.has(n),e.add(n);i&&this.set(Array.from(e))}disable(...t){const e=this.getDebugKeys();let i=!1;for(const n of t)i=i||e.has(n),e.delete(n);i&&this.set(Array.from(e))}set(t){this.storage.set(this.KEY_DEBUG,JSON.stringify(t)),this.debugItems=new Set(t),this.items.next(this.debugItems)}getDebugKeys(t){if(!this.debugItems||t){let e;try{if(e=JSON.parse(t||this.storage.get(this.KEY_DEBUG)||""),!Array.isArray(e))throw new Error("Failed to parse debug mode!")}catch(t){e=[]}this.debugItems=new Set(e)}return this.debugItems}}class te{constructor(t,e){this.env=t,this.date=e}getHardwareInfo(){const{navigator:t}=this.env.win,e=this.getGPU();return{device_memory:t.deviceMemory||void 0,hardware_concurrency:t.hardwareConcurrency||void 0,gpu_vendor:null==e?void 0:e.vendor,gpu_renderer:null==e?void 0:e.renderer}}getScreenInfo(){const t=this.env.win,e=t.screen;return{touch:t.navigator.maxTouchPoints>0||t.navigator.msMaxTouchPoints>0||"ontouchstart"in navigator,resolution_x:e.width,resolution_y:e.height,available_resolution_x:e.availWidth,available_resolution_y:e.availHeight,pixel_ratio:t.devicePixelRatio,pixel_depth:e.pixelDepth}}getNavigatorInfo(){const t=this.env.win.navigator;return{language:t.language,languages:t.languages,platform:t.platform,timezone_offset:this.date.timezoneOffset(),user_agent:t.userAgent,vendor:t.vendor}}getGPU(){const t=this.env.win.document.createElement("canvas");try{const e=t.getContext("webgl")||t.getContext("experimental-webgl"),i=null==e?void 0:e.getExtension("WEBGL_debug_renderer_info");if(!i)return;const n=e.getParameter(i.UNMASKED_VENDOR_WEBGL),r=e.getParameter(i.UNMASKED_RENDERER_WEBGL);if(n||r)return{vendor:n,renderer:r}}catch(t){}}}function ee(t){return new Promise((e=>{setTimeout(e,t)}))}function ie(t,e,i=!0){var n;return"boolean"==typeof t?t:t&&"boolean"==typeof t[e]&&null!==(n=t[e])&&void 0!==n?n:i}class ne{constructor(t,e,i){this.storage=t,this.crypto=e,this.date=i,this.KEY_ATTR_HASHES="hs",this.hashes=new Map,this.refresh(),this.storage.change(this.KEY_ATTR_HASHES).subscribe((t=>this.refresh(t.value)))}changed(t,e,i){let n=e;var r;"object"==typeof e&&e?n=JSON.stringify("object"==typeof(r=e)&&r?Array.isArray(r)?r.sort():Object.keys(r).sort().reduce(((t,e)=>(t[e]=r[e],t)),{}):r):"string"!=typeof e&&(n=JSON.stringify(e),void 0===n&&(n="undefined"));const s=this.date.now(),o=this.crypto.unsafeShortHash(t),a=this.crypto.unsafeShortHash(n),[c,u]=(this.hashes.get(o)||"").split("."),h=parseInt(u||"0",36);return!(c===a&&(!i||h&&!(s-h>i)))&&(this.hashes.set(o,`${a}.${s.toString(36)}`),this.persist(),!0)}refresh(t){let e=t?JSON.parse(t):this.storage.getJSON(this.KEY_ATTR_HASHES);e&&Array.isArray(e.hs)||(e={hs:[]},this.storage.setJSON(this.KEY_ATTR_HASHES,e)),this.hashes=new Map(e.hs)}persist(){const t={hs:Array.from(this.hashes)};this.storage.setJSON(this.KEY_ATTR_HASHES,t)}}class re{constructor(t,e){this.utmService=t,this.env=e,this.engineList=new RegExp(["google","bing","baidub","yahoo","yandex","ask","duckduckgo","naver","aol","seznam"].join("|"))}getSource(){const t=(this.env.doc.referrer||"").replace(/^https?:\/\//,""),e=this.utmService.getUTMParams();return(null==e?void 0:e.utm_source)?`utm_${e.utm_source}`:t?this.engineList.test(t)?`search_${t}`:`referral_${t}`:"direct"}}class se{}class oe{constructor(){this.completed=!1,this.task=new Promise(((t,e)=>{this.resolveTask=t,this.rejectTask=e}))}resolve(t){this.completed||(this.completed=!0,this.resolveTask(t))}reject(t){this.completed||(this.completed=!0,this.rejectTask(t))}waitUntilResolved(){return this.task}}class ae{constructor(t,e){this.env=t,this.uuid=e,this.locks=new Map,this.lockManager=t.win.navigator.locks}supported(){var t,e;return"function"==typeof(null===(t=this.lockManager)||void 0===t?void 0:t.request)&&"function"==typeof(null===(e=this.lockManager)||void 0===e?void 0:e.query)&&"function"==typeof this.env.win.AbortController}async locked(t){if(!this.lockManager)throw new Error("Native LockManager not supported!");return(await this.lockManager.query()).held.some((e=>e.name===t))}request(t,e=1e3){if(!this.lockManager)throw new Error("Native LockManager not supported!");const i=new oe,n=new oe,r=new AbortController,s={signal:r.signal};let o=!1;return this.lockManager.request(t,s,(()=>{o=!0;const e={name:t,id:this.uuid.generate(),clientId:"",createdDate:0,task:n};return this.locks.set(t,e),i.resolve(e),n.waitUntilResolved()})),ee(e).then((()=>{o||(r.abort(),i.resolve(null))})),i.waitUntilResolved()}async release(t){if(!this.lockManager)throw new Error("Native LockManager not supported!");const e=this.locks.get(t.name);e&&e.id===t.id&&(e.task.resolve(),this.locks.delete(e.name))}}class ce{constructor(t,e,i,n,r){this.storage=t,this.date=e,this.config=i,this.uuid=n,this.id=n.generate(),this.locks=this.syncLocks(),this.storage.change("locks","full","external").subscribe((t=>{this.syncLocks(t.value)})),r.onUnload().subscribe((()=>this.releaseAll()))}async release(t,e=!0){const i=this.locks.get(t.name);i&&i.clientId===this.id&&i.id===t.id&&(this.locks.delete(i.name),e&&this.syncLocks())}async locked(t){return this.locks.has(t)}async request(t,e=100,i=10){const n=this.date.now();for(;;){const r=await this.lock(t),s=this.date.now()-n>e;if(r||s)return r;await ee(i)}}async lock(t){if(this.locks.has(t))return null;{const e={name:t,clientId:this.id,id:this.uuid.generate(),createdDate:this.date.now()};return this.locks.set(t,e),this.syncLocks(),e}}syncLocks(t){if(!this.locks||t){const e=t||this.storage.get("locks"),i=JSON.parse(e||"null"),n=new Map(i||[]),r=this.releaseExpiredLocks(n);this.locks=r,n.size!==r.size&&this.writeLocks(r)}else this.writeLocks(this.locks);return this.locks}writeLocks(t){0===t.size?this.storage.remove("locks"):this.storage.setJSON("locks",Array.from(t))}releaseAll(){for(const[t,e]of this.locks)e.clientId===this.id&&this.release(e,!1);this.syncLocks()}releaseExpiredLocks(t){const e=this.date.now(),i=Array.from(t).filter((([t,i])=>e-i.createdDate<this.config.locksMaxAge));return new Map(i)}}!function(t){t[t.None=0]="None",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Verbose=4]="Verbose"}(Lt||(Lt={}));class ue{constructor(t,e){this.storage=t,this.config=e,this.KEY_LOG_LEVEL="log_level"}level(){return"number"!=typeof this.logLevel&&(this.logLevel=+(this.storage.get(this.KEY_LOG_LEVEL)||0)||this.config.logLevel||0),this.logLevel}setLevel(t){this.logLevel=t,this.storage.set(this.KEY_LOG_LEVEL,String(t))}enabled(t){return t<=this.level()}error(t,...e){this.print(t,Lt.Error,e)}warn(t,...e){this.print(t,Lt.Warn,e)}info(t,...e){this.print(t,Lt.Info,e)}verbose(t,...e){this.print(t,Lt.Verbose,e)}print(t,e,i){if(this.enabled(e))switch(e){case Lt.Error:console.log(`${t}:`),console.error(...i);break;case Lt.Warn:console.warn(`${t}: `,...i);break;case Lt.Info:console.info(`${t}: `,...i);break;case Lt.Verbose:console.log(`${t}: `,...i)}}}class he{constructor(t,e){this.env=e;const i=this.patchChanges();i.pipe(Ht((t=>!t))).subscribe((()=>{t.postMessage(!0)})),t.messages.pipe(wt((()=>!0))).subscribe(i)}changes(){return this.patchChanges()}patchChanges(){const t=this.env.doc;let e=he.patchedDocuments.get(t);if(e)return e;e=new H,he.patchedDocuments.set(t,e);const i=this.env.win.Document.prototype,n=Object.getOwnPropertyDescriptor(i,"cookie");let r=t.cookie;const s={enumerable:!0,configurable:!0,get:()=>t.__native_cookie,set:i=>{t.__native_cookie=i;const n=t.__native_cookie;if(n!==r)try{e.next(!1)}finally{r=n}}};return Object.defineProperty(i,"__native_cookie",n),Object.defineProperty(i,"cookie",s),e}}he.patchedDocuments=new Map;class le{parseCookies(t){const e=[],i=t.split(";");for(const t of i){const i={},n=t.indexOf("=");n>-1?(i.name=t.slice(0,n).trim()||"",i.value=t.slice(n+1).trim()):(i.name="",i.value=t.trim()),i.name&&(i.name=(i.name||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),i.value=(i.value||"").replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),e.push(i))}return e}serializeSetCookie(t){if(!t.name||"string"!=typeof t.name)throw new Error("Invalid cookie name!");const e={...t},i=encodeURIComponent(e.name).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),n=encodeURIComponent(e.value||"").replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent),r=this.serializeExpires(e.expires),s=[`${i}=${n}`];if("string"==typeof r&&s.push(`Expires=${r}`),"string"==typeof e.domain&&s.push(`Domain=${e.domain}`),s.push(`Path=${e.path||"/"}`),"string"==typeof t.sameSite){const i=t.sameSite.toUpperCase();"LAX"===i?s.push("SameSite=Lax"):"STRICT"===i?s.push("SameSite=Strict"):"NONE"===i&&(s.push("SameSite=None"),e.secure=!0)}return!0===e.secure&&s.push("Secure"),s.join("; ")}
serializeExpires(t){if(Number.isSafeInteger(t)){const e=new Date(t);if(!isNaN(+e))return e.toUTCString()}}
parseExpires(t){if("string"==typeof t){const e=Date.parse(t);if(Number.isSafeInteger(e))return e}}}class de{constructor(t){this.options=t,this.changes=new H}change(t,e="full",i="external"){let n=this.changes.asObservable().pipe(Ht((t=>"all"===i||("external"===i?t.external:!t.external))));if(t)if(e&&"full"!==e){if("start"!==e)throw new Error("Invalid keyMatch value!");n=n.pipe(Ht((e=>e.key.startsWith(t))))}else n=n.pipe(Ht((e=>e.key===t)));return n}getJSON(t){const e=this.get(t);return"string"==typeof e?JSON.parse(e):null}setJSON(t,e){const i=JSON.stringify(e);this.set(t,i)}getStorageKey(t){const e=this.options.storagePrefix;return e?`${e}${t}`:t}revertStorageKey(t){const e=this.options.storagePrefix;return(null==e?void 0:e.length)?t.slice(this.options.storagePrefix.length):t}isStorageKey(t){return!this.options.storagePrefix||t.startsWith(this.options.storagePrefix)}emitChange(t){this.changes.next(t)}}class fe extends de{constructor(t,e,i,n){super(n),this.env=t,this.parser=e,this.changeDetector=i,this.cookies=new Map,this.pull(!1),this.changeDetector.changes().pipe(Ht((t=>t||!n.storagePrefix))).subscribe((()=>this.pull()))}get(t){var e;return null!==(e=this.cookies.get(t))&&void 0!==e?e:null}set(t,e){const i={name:this.getStorageKey(t),value:e};this.cookies.set(t,e);const n=this.parser.serializeSetCookie(i);this.env.doc.cookie=n,this.emitChange({key:t,value:e,external:!1})}keys(){return Array.from(this.cookies.keys())}remove(t){const e={name:this.getStorageKey(t),value:"",expires:0};this.cookies.delete(t);const i=this.parser.serializeSetCookie(e);this.env.doc.cookie=i,this.emitChange({key:t,value:null,external:!1})}clear(){const t=this.keys();for(const e of t)this.remove(e)}all(){return Array.from(this.cookies).reduce(((t,[e,i])=>("string"==typeof i&&(t[e]=i),t)),{})}pull(t=!0){var e;const i=this.cookies,n=this.fetchCookies(),r=new Set([...i.keys(),...n.keys()]);if(this.cookies=n,t)for(const t of r){const r=i.get(t),s=null!==(e=n.get(t))&&void 0!==e?e:null;if(r!==s){const e={key:t,value:s,external:!0};this.emitChange(e)}}}fetchCookies(){const t=this.env.doc,e=this.parser.parseCookies(t.cookie).filter((t=>this.isStorageKey(t.name)));for(const t of e)t.name=this.revertStorageKey(t.name);const i=e.map((t=>[t.name,t.value]));return new Map(i)}}class pe extends de{constructor(t,e,i){super(i),this.storageArea=e,Ut(t.win,"storage").pipe(Ht((t=>!!t.key&&t.storageArea===e&&this.isStorageKey(t.key))),wt((t=>({key:this.revertStorageKey(t.key),value:t.newValue,external:!0})))).subscribe((t=>this.emitChange(t)))}get(t){return this.storageArea.getItem(this.getStorageKey(t))}set(t,e){this.storageArea.setItem(this.getStorageKey(t),e),this.emitChange({key:t,value:e,external:!1})}keys(){return Object.keys(this.storageArea).filter((t=>this.isStorageKey(t))).map((t=>this.revertStorageKey(t)))}remove(t){this.storageArea.removeItem(this.getStorageKey(t)),this.emitChange({key:t,value:null,external:!1})}clear(){const t=this.keys();for(const e of t)this.remove(e)}all(){return Object.keys(this.storageArea).filter((t=>this.isStorageKey(t))).reduce(((t,e)=>{const i=this.revertStorageKey(e),n=this.storageArea.getItem(e);return"string"==typeof n&&(t[i]=n),t}),{})}}class ve extends pe{constructor(t,e){super(t,t.win.localStorage,e)}}class ge extends pe{constructor(t,e){super(t,t.win.sessionStorage,e)}}class me extends de{constructor(t){super(t),this.db=new Map}get(t){var e;return null!==(e=this.db.get(t))&&void 0!==e?e:null}set(t,e){this.db.set(t,e),this.emitChange({key:t,value:e,external:!1})}keys(){return Array.from(this.db.keys())}remove(t){this.db.delete(t),this.emitChange({key:t,value:null,external:!1})}clear(){this.db=new Map}all(){return Array.from(this.db.entries()).reduce(((t,[e,i])=>(t[e]=i,t)),{})}}class ye{constructor(t,e,i,n){this.tabStorage=t,this.lockManager=e,this.uuid=i,this.config=n,this.tabIdKey="tab_id",this.enabled=!0,this.enabled=ie(this.config.eventEnrichment,"tab_id")}async init(){this.enabled&&(this.tabId=await this.trackTabId())}getTabId(){if(!this.tabId)throw new Error("TabManager is not initialized!");return this.tabId}async trackTabId(){const t=this.tabStorage.get(this.tabIdKey);let e=await this.lockAndUseTabId(t);if(!e){const t=this.uuid.generate();return e=await this.lockAndUseTabId(t),e||console.warn("Failed to lock the tab identifier!"),t}return e}async lockAndUseTabId(t){if(t){const e=`${this.tabIdKey}_${t}`;if(await this.lockManager.request(e))return this.tabStorage.set(this.tabIdKey,t),t;this.tabStorage.clear()}return null}}class be{constructor(t,e){this.env=t,this.config=e}getUTMParams(){const t=new URL(this.getInitialDocumentURL().toLowerCase()),e=t.searchParams.get("utm_source"),i=t.searchParams.get("utm_medium"),n=t.searchParams.get("utm_campaign"),r=t.searchParams.get("utm_term")||"",s=t.searchParams.get("utm_content")||"";if(e||n)return{utm_source:e||void 0,utm_medium:i||void 0,utm_campaign:n||void 0,utm_term:r||void 0,utm_content:s||void 0}}getInitialDocumentURL(){var t;if(this.config.initialDocURL)return this.config.initialDocURL;if("function"==typeof(null===(t=this.env.win.performance)||void 0===t?void 0:t.getEntries)){const t=this.env.win.performance.getEntries().find((t=>"navigation"===t.entryType));if(t&&t.name)return t.name}return this.env.win.document.location.href}}var we=function(t){null==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,t.constructor==Array?this.init_by_array(t,t.length):this.init_seed(t)};we.prototype.init_seed=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},we.prototype.init_by_array=function(t,e){var i,n,r;for(this.init_seed(19650218),i=1,n=0,r=this.N>e?this.N:e;r;r--){var s=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(1664525*((4294901760&s)>>>16)<<16)+1664525*(65535&s))+t[n]+n,this.mt[i]>>>=0,n++,++i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1),n>=e&&(n=0)}for(r=this.N-1;r;r--){s=this.mt[i-1]^this.mt[i-1]>>>30;this.mt[i]=(this.mt[i]^(1566083941*((4294901760&s)>>>16)<<16)+1566083941*(65535&s))-i,this.mt[i]>>>=0,++i>=this.N&&(this.mt[0]=this.mt[this.N-1],i=1)}this.mt[0]=2147483648},we.prototype.random_int=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var i;for(this.mti==this.N+1&&this.init_seed(5489),i=0;i<this.N-this.M;i++)t=this.mt[i]&this.UPPER_MASK|this.mt[i+1]&this.LOWER_MASK,this.mt[i]=this.mt[i+this.M]^t>>>1^e[1&t];for(;i<this.N-1;i++)t=this.mt[i]&this.UPPER_MASK|this.mt[i+1]&this.LOWER_MASK,this.mt[i]=this.mt[i+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},we.prototype.random_int31=function(){return this.random_int()>>>1},we.prototype.random_incl=function(){return this.random_int()*(1/4294967295)},we.prototype.random=function(){return this.random_int()*(1/4294967296)},we.prototype.random_excl=function(){return(this.random_int()+.5)*(1/4294967296)},we.prototype.random_long=function(){return(67108864*(this.random_int()>>>5)+(this.random_int()>>>6))*(1/9007199254740992)};var Se=we,_e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ke(t){return"string"==typeof t&&_e.test(t)}for(var Ee=[],Ie=0;Ie<256;++Ie)Ee.push((Ie+256).toString(16).substr(1));class Te{constructor(t,e){this.date=t,this.env=e,this.nativePRNG=this.getNativePRNG()}generate(){const t=this.date.now();return`a.${this.nativePRNG?"c":"m"}.${t.toString(36)}.${this.generateV4()}`}generateV4(){const t=this.randomValues(new Uint8Array(16));return t[6]=15&t[6]|64,t[8]=63&t[8]|128,function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(Ee[t[e+0]]+Ee[t[e+1]]+Ee[t[e+2]]+Ee[t[e+3]]+"-"+Ee[t[e+4]]+Ee[t[e+5]]+"-"+Ee[t[e+6]]+Ee[t[e+7]]+"-"+Ee[t[e+8]]+Ee[t[e+9]]+"-"+Ee[t[e+10]]+Ee[t[e+11]]+Ee[t[e+12]]+Ee[t[e+13]]+Ee[t[e+14]]+Ee[t[e+15]]).toLowerCase();if(!ke(i))throw TypeError("Stringified UUID is invalid");return i}(t)}randomValues(t){if(this.nativePRNG)return this.nativePRNG(t);this.mersenne||(this.mersenne=new Se(this.weakSeed()));let e=t.length;for(;e--;)t[e]=Math.floor(256*this.mersenne.random());return t}weakSeed(){const t=Array(127).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)));return[this.date.now(),...t]}getNativePRNG(){var t,e,i,n;const r=this.env.win;return(null===(e=null===(t=r.crypto)||void 0===t?void 0:t.getRandomValues)||void 0===e?void 0:e.bind(r.crypto))||(null===(n=null===(i=r.msCrypto)||void 0===i?void 0:i.getRandomValues)||void 0===n?void 0:n.bind(r.msCrypto))||void 0}}class xe{}const Ce={app:"",mode:"standard",version:"",build:{},logLevel:Lt.Error,sessionTimeoutMS:18e5,attributeTimeoutMS:6048e5,attributeSyncIntervalMS:864e5,plugins:[],transformPipes:[],enrichmentPipes:[],locksMaxAge:864e5,consentChecks:[],sessionStorageType:"persistent",hashStoreStorageType:"persistent",attributesStorageType:"persistent",tabManagerStorageType:"tab",serverCookies:!0,batchTimeMS:5e3,batchSize:5,serverBaseURL:"https://t.picsart.com/events/v1/web",transportTimeout:6e4,transportRetries:Number.POSITIVE_INFINITY,transportRetryBackoffMS:100,transportRetryBackoffMaxMS:3e4,eventEnrichment:!0,stateEnrichment:!0,attributeHints:!0,storagePrefix:"paa_"};class Ae{constructor(){this.providers=new Map,this.store=new Map,this.tasks=new Map,this.register({provide:Ae,useValue:this})}register(...t){for(const e of t)this.providers.set(e.provide,e);return this}factory(t){return this.providers.set(t.provide,t),this}get(t){const e=this.getOrCreate(t);return this.isPromise(e)?e:Promise.resolve(e)}getSync(t){const e=this.getOrCreate(t);if(this.isPromise(e)){const e=this.typeName(t);throw new Error(["Cannot instantiate dependency synchronously!",`One of the providers of the dependencies of '${e}' is asynchronous!`].join("\n"))}return e}getOrCreate(t){const e=this.store.get(t);if(e)return e;let i=this.tasks.get(t);if(i)return i.waitUntilResolved();i=new oe;const n=this.providers.get(t);if(!n)throw new Error(`No provider found for type '${this.typeName(t)}'!`);const r=this.getDeps(n);if(this.isPromise(r))return this.tasks.set(t,i),r.then((t=>this.createValue(n,t))).then((e=>{this.store.set(t,e),null==i||i.resolve(e),this.tasks.delete(t)})).catch((e=>{this.tasks.delete(t),null==i||i.reject(e)})),i.waitUntilResolved();{const e=this.createValue(n,r);return this.store.set(t,e),e}}createValue(t,e){if(void 0!==t.useValue)return t.useValue;if(t.useClass)return new t.useClass(...e);if(t.useFactory)return t.useFactory(...e);if(this.isClass(t.provide))return new t.provide(...e);{const e=this.typeName(t.provide);throw new Error(`No useClass or useFactory is provided for type '${e}'`)}}getDeps(t){this.checkDeps(t);const e=(Array.isArray(t.deps)?t.deps:[]).map((t=>this.getOrCreate(t)));return e.some((t=>this.isPromise(t)))?Promise.all(e):e}checkDeps(t){const e=(Array.isArray(t.deps)?t.deps:[]).map((t=>this.providers.get(t))),i=e.filter((t=>void 0===t));if(!i.length)return;const n=this.typeName(t.provide),r=e.map((t=>t?this.typeName(t):"?")).join(", "),s=`No provider found for the following tokens: ${i.map((t=>this.typeName(t))).join(", ")}`;throw new Error(`Cannot instantiate dependency '${n}(${r})'!\n ${s}`)}typeName(t){return this.isClass(t)?t.name:String(t)}isClass(t){return t&&"function"==typeof t&&"string"==typeof t.name&&"function"==typeof t.constructor&&t.name}isPromise(t){return t instanceof Promise||t.then&&t.catch}}class Pe{constructor(t){this.name=t}}class Ne{constructor(t){this.win=t,this.doc=this.win.document,this.navigator=this.win.navigator}}var Oe;!function(t){t[t.Normal=1]="Normal",t[t.High=2]="High",t[t.Force=3]="Force"}(Oe||(Oe={}));class Me{constructor(t,e,i,n,r,s,o,a,c){this.plugins=t,this.pipes=e,this.debug=i,this.logger=n,this.defaultPipes=r,this.queue=s,this.sessionService=o,this.date=a,this.config=c;const u=this.getContext();t.init(u)}event(t,e=Oe.Normal){this.processMessage("event",t,e)}attribute(t,e=Oe.Normal){this.processMessage("attribute",t,e)}attributeHint(t,e=Oe.Normal){this.processMessage("attribute-hint",t,e)}set(t){"object"==typeof t&&t&&!Array.isArray(t)&&this.sessionService.setState(t)}cmd(t,...e){if(Array.isArray(t))return this.cmd(t[0],...t.slice(1));const i=t.split("."),n=this[Me.commandMap.get(i[1]||i[0]||"")||i[0]||""];"function"==typeof n?n.apply(this,e):this.logger.warn("Tracker",`Analytics command '${t}' not found!`)}flush(){this.queue.flush()}getContext(){return{config:this.config,session:this.sessionService.getSession(),tracker:this}}processMessage(t,e,i){const n=this.getContext(),r={type:t,data:JSON.parse(JSON.stringify(e)),priority:i,state:n.session.state,timestamp:this.date.now()};this.pipes.transform(r,n).map((t=>this.defaultPipes.transform(t,n))).flat().map((t=>this.defaultPipes.enrich(t,n))).map((t=>this.pipes.enrich(t,n))).forEach((t=>this.queue.push(t)))}}Me.commandMap=new Map([["event","event"],["send","event"],["attribute","attribute"],["attr","attribute"],["set","set"],["state","set"]]);class Le{transform(t){const e={...t.data};return"string"==typeof e.event&&e.event||"string"!=typeof e.action||!e.action||(e.event=e.action,delete e.action),"object"==typeof e.data&&e.data||("object"==typeof e.parameters&&e.parameters?(e.data=e.parameters,delete e.parameters):e.data={}),t.data=e,[t]}}class Re{transform(t){const e=t.data;if("object"!=typeof e||!e||Array.isArray(e))return[];if(!("object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&["$overwrite","$inc","$dec"].indexOf(null==e?void 0:e.operation)>-1)&&"object"==typeof e&&e){const i=[];for(const n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;const r=e[n];if(!("string"==typeof r||"number"==typeof r||"boolean"==typeof r))continue;const s={...t,data:{operation:"$overwrite",name:n,value:r}};i.push(s)}return i}return[t]}}class De{constructor(t,e){this.hashStore=t,this.config=e}transform(t){const e=t.data;if("object"!=typeof e||!e||Array.isArray(e))return[];const i=`attribute_${e.name}`,n=`${e.operation}_${e.value}`;return this.hashStore.changed(i,n,this.config.attributeTimeoutMS)?[t]:[]}}class Ke{constructor(t,e,i,n){this.historyTracker=t,this.tabManager=e,this.env=i,this.config=n}enrich(t){const e={...t.data};return"object"==typeof e.data&&null!==e.data||(e.data={}),e.timestamp=t.timestamp,ie(this.config.eventEnrichment,"url")&&(e.data.url=this.env.win.location.href),ie(this.config.eventEnrichment,"tab_id")&&(e.data.tab_id=this.tabManager.getTabId()),this.historyTracker.previousUrl&&ie(this.config.eventEnrichment,"previous_url")&&(e.data.previous_url=this.historyTracker.previousUrl),this.env.win.document.referrer&&ie(this.config.eventEnrichment,"referrer")&&(e.data.referrer=this.env.win.document.referrer),t.data=e,t}}class Ue{constructor(t,e){this.sourceService=t,this.config=e}enrich(t){var e;if(!ie(this.config.eventEnrichment,"legacy_source"))return t;const i={...t.data};"object"==typeof i.data&&null!==i.data||(i.data={});const n=null===(e=null==i?void 0:i.data)||void 0===e?void 0:e.source;if(!0===n||"string"==typeof n&&"true"===n.toLowerCase()){const t=this.sourceService.getSource();i.data.source=t}return t.data=i,t}}const je=new Pe("STORAGE_SELECTOR"),Be=new Pe("COOKIE_BC"),He=new Pe("UN_PREFIXED_COOKIE_STORAGE"),Ve=new Pe("DEFAULT_PIPES_HOST_TOKEN"),$e=new Pe("PIPES_HOST_TOKEN");class Fe{constructor(t,e,i,n,r,s,o,a){this.attributeSpreadPipe=t,this.actionParamEventPipe=e,this.changedAttributesPipe=i,this.eventGlobalsPipe=n,this.sourcePipe=r,this.pipesHost=s,this.defaultPipesHost=o,this.config=a}registerPipes(){const t=this.config.transformPipes||[],e=this.config.enrichmentPipes||[],i=[{selector:"attribute",use:[this.attributeSpreadPipe,this.changedAttributesPipe]},{selector:"event",use:[this.actionParamEventPipe]}],n=[{selector:"event",use:[this.eventGlobalsPipe,this.sourcePipe]}];i.forEach((t=>this.defaultPipesHost.registerTransformSet(t))),n.forEach((t=>this.defaultPipesHost.registerEnrichmentSet(t))),t.forEach((t=>this.pipesHost.registerTransformSet(t))),e.forEach((t=>this.pipesHost.registerEnrichmentSet(t)))}}const Ye={provide:Fe,deps:[Re,Le,De,Ke,Ue,$e,Ve,xe]};class ze{constructor(){this.plugins=[]}init(t){this.plugins.forEach((e=>e.init&&e.init(t)))}enqueue(t,e){return this.plugins.every((i=>!i.enqueue||i.enqueue(t,e)))}beforeBatchSend(t,e){return this.plugins.reduce(((t,i)=>t&&i.beforeBatchSend?i.beforeBatchSend(t,e):t),t)}batchSent(t,e){this.plugins.forEach((i=>i.batchSent&&i.batchSent(t,e)))}sessionChange(){throw new Error("Method not implemented.")}stateChange(){throw new Error("Method not implemented.")}register(t){this.plugins.push(t)}}class qe{constructor(t){this.consentService=t}init(t){this.consentService.changes().pipe(Ht((t=>!1!==t.consent.report))).subscribe((e=>{this.fireChangeEvent(e,t)}))}fireChangeEvent(t,e){const i={event:"consent_change",data:this.buildChangeEvent(t)};e.tracker.event(i,Oe.Force)}buildChangeEvent({consent:t,result:e}){var i,n,r,s,o,a,c;const u="string"==typeof t.consent?t.consent:t.consent.name;return{mode:t.mode,provider:u,state:e.state,necessary_cookies:null!==(i=e.necessary_cookies)&&void 0!==i?i:void 0,performance_cookies:null!==(n=e.performance_cookies)&&void 0!==n?n:void 0,functional_cookies:null!==(r=e.functional_cookies)&&void 0!==r?r:void 0,targeting_cookies:null!==(s=e.targeting_cookies)&&void 0!==s?s:void 0,social_media_cookies:null!==(o=e.social_media_cookies)&&void 0!==o?o:void 0,provider_consent_id:null!==(a=e.provider_consent_id)&&void 0!==a?a:void 0,response_time:null!==(c=e.response_time)&&void 0!==c?c:void 0}}}class Ge{constructor(t){this.historyTracker=t}init(t){this.ctx=t,this.send(!0),this.historyTracker.navigation.subscribe((()=>{this.send(!1)}))}send(t){var e;const i=null===(e=this.ctx)||void 0===e?void 0:e.tracker;if(!i)return;const n={event:"navigation",data:{initial:t}};i.event(n,Oe.High)}}class Je{constructor(t,e){this.dataLayer=t,this.commandPrefix=e}init(t){if(this.tracker=t.tracker,!Array.isArray(this.dataLayer))throw new Error("DataLayer must be an array!");this.defaultPush=this.dataLayer.push.bind(this.dataLayer),this.dataLayer.push=this.onPush.bind(this),this.readFromBeginning()}onPush(...t){for(const e of t)this.processItem(e);return this.defaultPush?this.defaultPush(...t):0}readFromBeginning(){for(const t of this.dataLayer)this.processItem(t)}processItem(t){if(this.tracker&&"object"==typeof t&&t)if(this.isCommand(t)){const e=Array.from(t);this.tracker.cmd(e)}else if("event"===t.pulse){const e=this.normalize(t);this.tracker.event(e)}else if("attribute"===t.pulse){const e=this.normalize(t);this.tracker.attribute(e)}else if("state"===t.pulse){const e=this.normalize(t);this.tracker.set(e)}else"custom_event"!==t.event&&"custom_event_non_interaction"!==t.event||this.tracker.event(t.data)}isCommand(t){return(Array.isArray(t)||"[object Arguments]"===Object.prototype.toString.call(t))&&"string"==typeof t[0]&&t[0].startsWith(this.commandPrefix)}normalize(t){const e={...t};return delete e.paa,e}}class We{constructor(t,e,i,n,r){this.deviceInfoService=t,this.storage=e,this.date=i,this.utm=n,this.config=r,this.KEY_LAST_ATTRIBUTE_SYNC="attr"}init(t){if(!this.shouldSendHints())return;const e={...this.deviceInfoService.getScreenInfo(),...this.deviceInfoService.getHardwareInfo(),...this.deviceInfoService.getNavigatorInfo()};t.tracker.attributeHint(e);const i=this.utm.getUTMParams();i&&t.tracker.attribute(i),this.sent()}shouldSendHints(){const t=+(this.storage.get(this.KEY_LAST_ATTRIBUTE_SYNC)||"0");return this.date.now()-t>this.config.attributeSyncIntervalMS}sent(){this.storage.set(this.KEY_LAST_ATTRIBUTE_SYNC,this.date.now().toString())}}class Xe{constructor(t,e,i){this.sessionService=t,this.debug=e,this.config=i}init(){At([this.sessionService.session,this.debug.items]).subscribe((([t])=>{this.setState(t)}))}setState(t){const{app:e}=t,i=this.getLanguage(),n={app:ie(this.config.stateEnrichment,"app")?e:void 0,market:ie(this.config.stateEnrichment,"market")?"web":void 0,platform:ie(this.config.stateEnrichment,"platform")?"web":void 0,version:ie(this.config.stateEnrichment,"version")?"0":void 0,language_code:ie(this.config.stateEnrichment,"language_code")?i:void 0,v:ie(this.config.stateEnrichment,"pulse_version")?this.config.version:void 0,debug:this.debug.enabled("debugger")};this.sessionService.setState(n)}getLanguage(){return(navigator.language||navigator.languages[0]||"unknown").split("-").shift()||"unknown"}}class Qe{constructor(t){this.visibility=t}init(t){const e=t.tracker;this.visibility.onVisibilityChange().pipe(Ht((t=>!t))).subscribe((()=>e.flush()))}}class Ze{constructor(t,e,i,n,r,s,o,a){this.navigationEventPlugin=t,this.unloadSyncPlugin=e,this.statePlugin=i,this.deviceAttributesPlugin=n,this.consentEventPlugin=r,this.pluginHost=s,this.env=o,this.config=a}registerPlugins(){var t,e,i,n;const r=[this.unloadSyncPlugin,this.statePlugin,this.navigationEventPlugin,this.deviceAttributesPlugin,this.consentEventPlugin,...this.config.plugins||[]];(null===(t=this.env.win.pulse)||void 0===t?void 0:t.l)&&Array.isArray(null===(e=this.env.win.pulse)||void 0===e?void 0:e.l)&&r.push(new Je(this.env.win.pulse.l,"paa.")),(null===(i=this.env.win.pulse)||void 0===i?void 0:i.q)&&Array.isArray(null===(n=this.env.win.pulse)||void 0===n?void 0:n.q)&&r.push(new Je(this.env.win.pulse.q,"")),r.push(...this.config.plugins||[]),r.forEach((t=>this.pluginHost.register(t)))}}const ti={provide:Ze,deps:[Ge,Qe,Xe,We,qe,ze,Ne,xe]};class ei{constructor(){this.transformPipes=[],this.enrichmentPipes=[]}process(t,e){return this.transform(t,e).map((t=>this.enrich(t,e)))}transform(t,e){const i=this.selectPipeSet(t,this.transformPipes);let n=[t];for(const t of i){if(!t.transform)continue;const i=[];for(const r of n){const n=t.transform(r,e);i.push(...n)}n=i}return n}enrich(t,e){return this.selectPipeSet(t,this.enrichmentPipes).reverse().reduce(((t,i)=>i.enrich(t,e)),t)}registerTransformSet(t){this.transformPipes.push(t)}registerEnrichmentSet(t){this.enrichmentPipes.push(t)}selectPipeSet(t,e){for(const i of e){if(!("*"===i.selector||i.selector===t.type||"function"==typeof i.selector&&i.selector(t)||!1))continue;if(!("function"==typeof i.exclude&&i.exclude(t)))return[...i.use]}return[]}}class ii{constructor(t,e,i,n){this.date=t,this.uuid=e,this.storage=i,this.config=n,this.KEY_DEVICE_ID="did",this.KEY_SESSION_STATE="ss",this.KEY_SESSION_ID="sid",this.KEY_LAST_ACTIVITY="la",this.registerStorageChangeListeners(),this.session=new $(this.getSession())}setState(t){const e=this.getState(),i={...e,...t};var n,r;(n=e)===(r=i)||"object"==typeof n&&"object"==typeof r&&Object.keys({...n,...r}).every((t=>n[t]===r[t]))||(this.state=i,this.storage.setJSON(this.KEY_SESSION_STATE,i))}getState(){return this.state?this.state:this.refreshState()}getSession(t=!0){var e;const i=this.getDeviceId(),n=this.isSessionExpired(),r=!this.sessionId||n?this.fetchSessionId():this.sessionId;n&&this.setState({device_id:ie(this.config.stateEnrichment,"device_id")?i:void 0,session_id:ie(this.config.stateEnrichment,"session_id")?r:void 0});const s=this.getState(),o=this.lastActivity||0,a={app:this.config.app,deviceId:i,sessionId:r,lastActivity:o,state:s};return t&&this.refreshLastActivity(),n&&(null===(e=this.session)||void 0===e||e.next(a)),a}refreshLastActivity(){const t=this.date.now();t-(this.lastActivity||0)>1e3&&(this.lastActivity=t,this.storage.set(this.KEY_LAST_ACTIVITY,this.lastActivity.toString()))}setDeviceId(t){t!==this.deviceId&&"string"==typeof t&&t.trim()&&(this.deviceId=t.trim(),this.storage.set(this.KEY_DEVICE_ID,t),this.setState({device_id:t}))}getDeviceId(){return this.deviceId?this.deviceId:this.fetchDeviceId()}isSessionExpired(){const{sessionTimeoutMS:t}=this.config,e=this.date.now();if(this.sessionId&&this.lastActivity){if(!(e-this.lastActivity>t))return!1}return!0}refreshState(t){const e=t||this.storage.getJSON(this.KEY_SESSION_STATE)||this.state||{};return this.state=e,e}fetchDeviceId(){return this.deviceId=this.storage.get(this.KEY_DEVICE_ID),this.deviceId||(this.deviceId=this.generateDeviceId(),this.storage.set(this.KEY_DEVICE_ID,this.deviceId)),this.deviceId}fetchSessionId(){const{sessionTimeoutMS:t}=this.config,e=this.date.now(),i=this.storage.get(this.KEY_LAST_ACTIVITY),n=this.storage.get(this.KEY_SESSION_ID);return!n||e-+(i||"0")>t?(this.sessionId=this.generateSessionId(),this.storage.set(this.KEY_SESSION_ID,this.sessionId),this.refreshLastActivity(),this.sessionId):n}registerStorageChangeListeners(){this.storage.change(this.KEY_SESSION_ID).subscribe((()=>this.fetchSessionId())),this.storage.change(this.KEY_DEVICE_ID).subscribe((t=>this.setDeviceId(t.value||""))),this.storage.change(this.KEY_SESSION_STATE).subscribe((({value:t})=>this.refreshState(JSON.parse(t||"{}")))),this.storage.change(this.KEY_LAST_ACTIVITY).subscribe((({value:t})=>{const e=+(t||"0");(this.lastActivity||0)<e&&(this.lastActivity=e)}))}generateSessionId(){return`${this.date.now()}_${this.deviceId}`}generateDeviceId(){return this.uuid.generate()}}class ni{constructor(t){this.env=t,this.navigation=new H,this.previousUrl=t.doc.referrer||"",this.init()}init(){var t;"function"==typeof(null===(t=this.env.win.history)||void 0===t?void 0:t.pushState)&&(this.patch("back"),this.patch("forward"),this.patch("go"),this.patch("pushState"),this.patch("replaceState"))}patch(t){const e=this.env.win.history,i=e[t].bind(e);e[t]=(...t)=>{const n=this.env.win.location.href;i.apply(e,t);const r=this.env.win.location.href;n!==r&&(this.previousUrl=n,this.navigation.next(r))}}}class ri{constructor(t){this.env=t,this.hiddenPropName="hidden",this.visibilityStatePropName="visibilityState",this.visibilityEventName="visibilitychange",this.configureVisibilityListener()}get visible(){return this.isPageVisible()}onUnload(){return Bt(Ut(this.env.win,"beforeunload"),Ut(this.env.win,"unload"),Ut(this.env.win,"pagehide")).pipe(function(t,e){var i=arguments.length>=2;return function(n){return n.pipe(t?Ht((function(e,i){return t(e,i,n)})):L,$t(1),i?Vt(e):zt((function(){return new bt})))}}())}onVisibilityChange(){const t=this.env.win.document;let e=new H;return this.configureVisibilityListener()&&(e=Ut(t,this.visibilityEventName).pipe(wt((()=>this.isPageVisible())))),this.fullVisibilityAPISupport()||(e=Bt(e,this.onUnload().pipe(wt((()=>!1))))),e.pipe(Ft())}isPageVisible(){const t=this.env.doc;return"string"==typeof t[this.visibilityStatePropName]&&t[this.visibilityStatePropName]?"visible"===t[this.visibilityStatePropName]:"boolean"!=typeof t[this.hiddenPropName]||!t[this.hiddenPropName]}configureVisibilityListener(){const t=["","ms","webkit","moz","o"],e=this.env.doc;for(const i of t){const t=i?`${i}Hidden`:"hidden",n=i?`${i}VisibilityState`:"visibilityState",r=(i||"")+"visibilitychange";if(t in e||n in e)return this.hiddenPropName=t,this.visibilityEventName=r,this.visibilityStatePropName=n,!0}return!1}fullVisibilityAPISupport(){const t=this.env.doc,e=this.env.win.navigator.userAgent;return"string"==typeof t.visibilityState&&"boolean"==typeof t.hidden&&void 0!==t.onvisibilitychange&&!/Safari/i.test(e)}}class si{constructor(t,e,i,n){this.date=t,this.transport=e,this.config=n,this.messages=[],this.lastBatchTime=0,this.inFlight=!1,this.nextBatchTime=0,this.immediateFlushRequired=!1,this.batchConfig=this.getTrackerBatchConfig(),i.trackingEnabled().subscribe((t=>{this.trackingEnabled=t,this.schedule()}))}push(t){const e=t.priority===Oe.Force,i=t.priority===Oe.High||e;this.messages.push(t),this.schedule(i,e)}flush(){this.schedule(!0)}schedule(t=!1,e=!1){if(!this.trackingEnabled&&!e)return void(this.immediateFlushRequired=this.immediateFlushRequired||t);if(!this.messages.length)return;if(this.immediateFlushRequired&&(t=!0,this.immediateFlushRequired=!1),!t&&this.inFlight)return;const i=this.date.now(),n=i-this.lastBatchTime,r=t||this.messages.length>=this.config.batchSize||n>=this.config.batchTimeMS,s=r?0:Math.max(0,this.config.batchTimeMS-n),o=i+s;if(r)return this.clearTimer(),this.lastBatchTime=i,this.sendBatch(!0,(()=>this.batchDone()));o>this.nextBatchTime&&this.timer||(this.timer&&clearTimeout(this.timer),this.nextBatchTime=o,this.timer=setTimeout((()=>{this.lastBatchTime=this.date.now(),this.sendBatch(!1,(()=>this.batchDone()))}),s))}batchDone(){this.clearTimer(),this.schedule()}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=void 0)}sendBatch(t=!1,e){this.inFlight=!0;const i=this.makeBatch(t);if(!i)return this.inFlight=!1,void e();this.transport.send(i,(()=>{this.inFlight=!1,e()}))}makeBatch(t=!1){const e=t?this.messages.length:Math.min(this.messages.length,this.config.batchSize),i=[];let n=null;for(let t=0;t<e;t++){const t=this.messages[0],e=[...i,t],s={chunks:this.groupByContext(e)};if((r=s,function(t){let e=t.length;for(let i=t.length-1;i>=0;i--){const n=t.charCodeAt(i);n>127&&n<=2047?e++:n>2047&&n<=65535&&(e+=2),n>=56320&&n<=57343&&i--}return e}(JSON.stringify(r)))>6e4&&n)break;n=s,i.push(t),this.messages.shift()}var r;return n}groupByContext(t){const e=new Map;for(const i of t){let t=e.get(i.state);t||(t=[],e.set(i.state,t)),t.push({...i,state:void 0,priority:void 0})}return Array.from(e).map((t=>({config:this.batchConfig,state:t[0],messages:t[1]})))}getTrackerBatchConfig(){const t=ie(this.config.stateEnrichment,"device_id"),e=ie(this.config.stateEnrichment,"session_id"),i=ie(this.config.eventEnrichment,"tab_id");return{deviceId:t?this.config.sessionStorageType:"none",sessionId:e?this.config.sessionStorageType:"none",tabId:i?this.config.tabManagerStorageType:"none",serverCookies:this.config.serverCookies}}}class oi{constructor(t,e,i,n,r){this.documentVisibility=t,this.sessionService=e,this.env=i,this.debug=n,this.config=r}get async(){return this.documentVisibility.visible}send(t,e){const i=JSON.stringify(t);this.retry((t=>{this.trySend(i,t)}),e)}trySend(t,e){this.fetch(t,e)||(this.async?this.sendXHR(t,!0,e):this.sendBeacon(t,e))}fetch(t,e){const i=this.env.win,n="Request"in i&&"boolean"==typeof new Request(this.config.serverBaseURL).keepalive;if(!("function"==typeof i.fetch&&"AbortController"in i)||!this.async&&!n)return!1;const r=new i.AbortController,s=this.getHeaders(),o=i.fetch(`${this.config.serverBaseURL}/${this.config.app}/fetch`,{method:"POST",body:t,headers:s,keepalive:!0,mode:"cors",credentials:"include",signal:r.signal}),a=i.setTimeout((()=>{r.abort()}),this.config.transportTimeout);return o.then((t=>{i.clearTimeout(a),this.replaceDeviceId(t.headers.get("paa-did")),e(this.succeeded(t.status))})).catch((()=>{i.clearTimeout(a),e(!1)})),!0}sendBeacon(t,e){var i;if("function"!=typeof(null===(i=this.env.win.navigator)||void 0===i?void 0:i.sendBeacon))return void this.sendXHR(t,!1,e);this.env.win.navigator.sendBeacon(`${this.config.serverBaseURL}/${this.config.app}/beacon`,t)?e(!0):this.sendXHR(t,!1,e)}sendXHR(t,e,i){try{if(!this.env.win.XMLHttpRequest)return void i(!1);const n=new this.env.win.XMLHttpRequest,r=this.getHeaders();e&&(n.timeout=this.config.transportTimeout,n.onreadystatechange=()=>{4===n.readyState&&(this.replaceDeviceId(n.getResponseHeader("paa-did")),i(this.succeeded(n.status)))}),n.open("POST",`${this.config.serverBaseURL}/${this.config.app}/xhr`,e),n.withCredentials=!0;for(const t in r){const e=r[t];n.setRequestHeader(t,String(e))}n.send(t),e||(this.replaceDeviceId(n.getResponseHeader("paa-did")),i(this.succeeded(n.status)))}catch(t){i(!1)}}getHeaders(){const t=this.debug.enabled("receiver");return{"Content-Type":"application/json","receiver-debug":String(t)}}retry(t,e,i=0){t((n=>{const r=i<=this.config.transportRetries;if(n||!r)return e(n);const s=this.backoffTime(++i);if(!s)return this.retry(t,e,i);setTimeout((()=>{this.retry(t,e,i)}),s)}))}succeeded(t){return t>=200&&t<=400}backoffTime(t){if(!this.async&&t<10)return 0;const e=Math.floor(Math.pow(1e3,t/50)*this.config.transportRetryBackoffMS);return Math.min(this.config.transportRetryBackoffMaxMS,e)}replaceDeviceId(t){t&&this.sessionService.setDeviceId(t)}}const ai=[{provide:Qt,deps:[Ne]},{provide:Te,deps:[Qt,Ne]},{provide:Qt,deps:[Ne]},{provide:Zt,deps:[ve,xe]},{provide:ue,deps:[ve,xe]},{provide:Xt},{provide:ne,useFactory:(t,e,i,n)=>new ne(i(n.hashStoreStorageType),t,e),deps:[Xt,Qt,je,xe]},{provide:te,deps:[Ne,Qt]},{provide:le},{provide:Be,useFactory:(t,e)=>new Gt("pulse-cookie-changes",t,e),deps:[ve,Ne]},{provide:he,deps:[Be,Ne]},{provide:Wt,deps:[He]},{provide:Jt,deps:[Wt,ue,ne,xe]},{provide:me,deps:[xe]},{provide:ve,deps:[Ne,xe]},{provide:ge,deps:[Ne,xe]},{provide:He,useFactory:(t,e,i,n)=>new fe(t,e,i,{...n,storagePrefix:""}),deps:[Ne,le,he,xe]},{provide:je,useFactory:(t,e,i)=>n=>{switch(n){case"memory":return t;case"persistent":return i;case"tab":return e}},deps:[me,ge,ve]},{provide:ae,deps:[Ne,Te]},{provide:ce,deps:[ve,Qt,xe,Te,ri]},{provide:se,useFactory:(t,e)=>t.supported()?t:e,deps:[ae,ce]},{provide:ye,async useFactory(t,e,i,n){const r=new ye(t(n.tabManagerStorageType),e,i,n);return await r.init(),r},deps:[je,se,Te,xe]},{provide:ri,deps:[Ne]},{provide:ni,deps:[Ne]},{provide:be,deps:[Ne,xe]},{provide:re,deps:[be,Ne]},{provide:ii,useFactory:(t,e,i,n)=>new ii(t,e,i(n.sessionStorageType),n),deps:[Qt,Te,je,xe]},{provide:oi,deps:[ri,ii,Ne,Zt,xe]},{provide:si,deps:[Qt,oi,Jt,xe]},{provide:ze},{provide:$e,useClass:ei},{provide:Ve,useClass:ei},{provide:Re},{provide:Le},{provide:De,deps:[ne,xe]},{provide:Ke,deps:[ni,ye,Ne,xe]},{provide:Ue,deps:[re,xe]},{provide:Qe,deps:[ri]},{provide:Ge,deps:[ni]},{provide:Xe,deps:[ii,Zt,xe]},{provide:Qe,deps:[ri]},{provide:Qe,deps:[ri]},{provide:We,useFactory:(t,e,i,n,r)=>new We(t,n(r.attributesStorageType),e,i,r),deps:[te,Qt,be,je,xe]},{provide:qe,deps:[Jt]},ti,Ye,{provide:Me,deps:[ze,$e,Zt,ue,Ve,si,ii,Qt,xe]}];async function ci(t,e){const i=function(t,e){var i,n,r;const s={...Ce,...t||{},initialDocURL:null===(i=e.win.pulse)||void 0===i?void 0:i.idu,version:(null===(n=e.win.env)||void 0===n?void 0:n.PULSE_VERSION)||"",build:null===(r=e.win.env)||void 0===r?void 0:r.PULSE_BUILD_INFO};return"standard"!==s.mode&&(s.sessionStorageType="memory",s.hashStoreStorageType="memory",s.attributesStorageType="memory",s.tabManagerStorageType="memory",s.eventEnrichment={tab_id:!1,legacy_source:!1,referrer:!1},s.stateEnrichment={device_id:!1,session_id:"page-session"===s.mode,market:!1,platform:!1},s.attributeHints=!1,s.serverCookies=!1),s}(t,e),n=new Ae;n.register({provide:xe,useValue:i},{provide:Ne,useValue:e},...ai);const r=await n.get(Fe),s=await n.get(Ze);return r.registerPipes(),s.registerPlugins(),n.get(Me)}(async function(){var t,e;const i=new Ne(window),n=i.win,r=(null===(t=n.pulse)||void 0===t?void 0:t.c)||{};if(r.app=(null===(e=n.pulse)||void 0===e?void 0:e.a)||r.app,!r.app)throw new Error("Failed to initialize PicsArt Analytics: Unknown app!");const s=await ci(r,i);n.pulse=n.pulse||s.cmd.bind(s),n.pulse&&(n.pulse.tracker=s)})().catch(console.error)}));